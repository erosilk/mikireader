<html>

<head>
    <title>ereader</title>
    <script src="assets/epub.js"></script>
    <script src="assets/zip.min.js"></script>
    <script src="assets/hammer.min.js"></script>
    <style>
        #area {
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>

<body>
    <div id="drop_zone">Drop your .epub file here</div>
    <output id="list"></output>
    <div id="area"></div>

    <script>
        var Book;

        function handleFileSelect(evt) {
            document.querySelectorAll("#area div").forEach(div => {
                div.remove();
            })
            evt.stopPropagation();
            evt.preventDefault();
            var files = evt.dataTransfer.files;
            var path = (window.URL || window.webkitURL).createObjectURL(files[0]);
            XMLRequest(path);
        }

        function XMLRequest(path) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', path, true);
            xhr.responseType = 'arraybuffer';
            xhr.onload = function (e) {
                if (this.status == 200) {
                    readBook(this.response);
                }
            };
            xhr.send();
        }

        function readBook(blob) {
            Book = ePub(blob);
            Book.renderTo("area");
        }

        function handleDragOver(evt) {
            evt.stopPropagation();
            evt.preventDefault();
            evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
        }

        // Setup the dnd listeners.
        var dropZone = document.getElementById('drop_zone');
        dropZone.addEventListener('dragover', handleDragOver, false);
        dropZone.addEventListener('drop', handleFileSelect, false);
    </script>
</body>

</html>